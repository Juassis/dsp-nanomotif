# Project goals

The methylation pattern of DNA methyltransferases will be identified in isolates and metagenomics through nanopore sequencing and the use of [Nanomotif](#nanomotif). Proper expression and folding will be ensured through the use of a dual-reporter system2, prior to functional testing

## Nanomotif

Nanomotif is a Python package designed to explore methylation in prokaryotic genomes using Nanopore sequencing. Nanomotif is a fast, scalable, and sensitive tool for identification and utilization of methylation motifs in monocultures and metagenomic samples. Nanomotif offers de novo methylated motif identification, metagenomic bin contamination detection, bin association of unbinned contigs, and linking of MTase genes to methylation motifs.

[NanoMotif](https://nanomotif.readthedocs.io/en/latest/)

# Methodos

The extracted DNA was sequenced on an Oxford Nanopore MinION device using a 10.4.1 flow cell and the SQK-RBK114-96 rapid barcoding kit, with library preparation modifications as described in (1). The raw data was basecalled and demultiplexed utilising an A100 GPU running standalone Dorado (v0.9.1) and the super accuracy basecalling model (dna_r10.4.1_e8.2_400bps_sup@v5.0.0) with detection of the following modifications: 4mC_5mC,6mA. 
 
## Getting the data
The data has been generate in two different sequencing: run1 we ran all the samples we had, and some of the sequences did not have a good enough coverage, so we loaded those again, and ran it, which is run3 (something was wrong in "run2" and it was terminated early).

### Data location

**O: drive**
```{ }
O:\Scientific dep\009_Experimental data\034_Nanopore\Sheila
```
**Azure**
```{ }
/mnt/nanomotif/Sharing/Merged
```

## Merging the runnings: run1 and run 3

Run the scripts: 

[03_merge-barcode-folders.sh] (https://github.com/Juassis/dsp-nanomotif/blob/main/01_Documentation/03_merge-barcode-folders.sh) to merge run1 and run3.


## Quality Control (QC)

For QC analysis, run the scripts:

[01_check-reads-length.sh](https://github.com/Juassis/dsp-nanomotif/blob/main/01_Documentation/01_check-reads-length.sh)

[02_count-files.sh](https://github.com/Juassis/dsp-nanomotif/blob/main/01_Documentation/02_count-files.sh)

[Nanoplot](https://github.com/wdecoster/NanoPlot)


```{ }
pip install NanoPlot
NanoPlot --summary sequencing_summary.txt --loglength -o summary-plots-log-transformed  
NanoPlot -t 2 --fastq reads1.fastq.gz reads2.fastq.gz --maxlength 40000 --plots dot --legacy hex
NanoPlot -t 12 --color yellow --bam alignment1.bam alignment2.bam alignment3.bam --downsample 10000 -o bamplots_downsampled
```

# Requirements to run Nanomotif

To run the Nanomotif, we need to generate some files before:

The assembly file should contain all contigs in FASTA format. Each header should have a unique contig identifier. The sequence should only include standard nucleotide or IUPAC characters (either uppercase or lowercase). Nanomotif has been primarily developed and tested using assemblies generated by Flye.

## Requirements:

Format: FASTA
Contains all contigs for evaluation
Contig ID in the FASTA header
IUPAC-compliant characters only

## Assemble the genomes

Fly (metaFlye for metagenomics)

[05_flye.sh](https://github.com/Juassis/dsp-nanomotif/blob/main/01_Documentation/05_flye.sh)

## Methylation Pileup

The methylation pileup file indicates how many mapped reads at each position show evidence of methylation. To generate this file:

- Map reads (with methylation calls) to the assembly.
- Use modkit pileup to create the pileup.

### Merging the BAM files with the modification

First, we need to merge all the BAM files from each barcode using the following script:

[04_merging-bams.sh](https://github.com/Juassis/dsp-nanomotif/blob/main/01_Documentation/04_merging-bams.sh)

### Pileup

In this step, we need to pass the BAM files merged and all the fasta files (assembly) to get the pileup.

**Run the code:**

[06_pre-run-pileup.sh](https://github.com/Juassis/dsp-nanomotif/blob/main/01_Documentation/06_pre-run-pileup.sh)

After that, we can prepare our bins information. Remember that for now we're working with isolated genomes, but in the future it will be metagenomics.

### Contig-Bin Relationship

[07_run_bins.sh](https://github.com/Juassis/dsp-nanomotif/blob/main/01_Documentation/07_run_bins.sh)

**For one file:**

```{ }
grep ">" "$BINFILENAME" | sed 's/>//' | awk -v bin="$BINNAME" '{print $1 "\t" bin}' > "$OUT"
```
# Call modcall and run nanomotif2

With all files prepared, we're now ready to run the Nanomotif:

```{ }
conda activate nanomotif2
```
[08_run_nanomotif_loop.sh](https://github.com/Juassis/dsp-nanomotif/blob/main/01_Documentation/08_run_nanomotif_loop.sh)

# Results

Results sent.
